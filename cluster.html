<!DOCTYPE html>

<html>

<head>
    <title>解糖系</title>
</head>

<body>

<style>

.node {
  stroke: #fff;
  stroke-width: 1.5px;
}

.link {
  stroke: #999;
  stroke-opacity: .6;
}

</style>

<select id="target" onChange="screenChange()">
	<option value="1">解糖系</option>
</select>

<div id="d3div"></div>

<script src="//code.jquery.com/jquery.js"></script>
<script src="//d3js.org/d3.v3.min.js"></script>
<script>

var width = $("#d3div").width(),
    height = 0.95 * window.innerHeight;

var color = d3.scale.category20();

var force = d3.layout.force()
    .charge(-600)//反発力　-120 -240
    .linkDistance(200)//自然長　30 120
    .size([width, height])
    .gravity(0.05);

//最初の描画用
screenChange();

// select要素を取得
function screenChange(){

//削除する(再描画用)
	d3.select("#d3div").selectAll("svg")
	    .remove();

//描画する
	var svg = d3.select("#d3div").append("svg")
	    .attr("width", width)
	    .attr("height", height);

	var element = document.getElementById( "target" ) ;

	d3.json("test.json", function(error, graph) {
	  if (error) throw error;

	  force
	      .nodes(graph.nodes)
	      .links(graph.links)
	      .start();

	  var link = svg.selectAll(".link")
	      .data(graph.links)
	    .enter().append("line")
	      .attr("class", "link")
	      .style("stroke-width", 1);//Math.sqrt(d.value)

	  var node = svg.selectAll(".node")
	      .data(graph.nodes)
	    .enter().append("circle")
	      .attr("class", "node")
	      .attr("r", 5)//20 5
	      .style("fill", "orange")//function(d) { return color(d.group); }
	      .call(force.drag);

//	  link.append("title")
//	      .text(function(d) { return "共通スタッフの一覧（"+ d.value +"人）：\n" + d.animator; });

// nodeのラベル周りの設定
	  var label = svg.selectAll('text')
	      .data(graph.nodes)
	      .enter()
	      .append('text')
	      .attr({
	          "text-anchor":"middle",
	          "fill":"black",
	          "font-size": "12px"//9
	      })
	      .text(function(d) { return d.id; });//data.label

	  force.on("tick", function() {
	    link.attr("x1", function(d) { return d.source.x; })
	        .attr("y1", function(d) { return d.source.y; })
	        .attr("x2", function(d) { return d.target.x; })
	        .attr("y2", function(d) { return d.target.y; });

	    node.attr("cx", function(d) { return d.x; })
	        .attr("cy", function(d) { return d.y; });

    // labelも追随するように

	    label.attr({
	        x: function(d) { return d.x;},
	        y: function(d) { return d.y;}
	    });

	  });
	});
}


</script>



</body>
</html>
